# 开发信息
CREATE TABLE `order_base_info` (
  `id` int(20) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `pay_id` int(11) DEFAULT NULL COMMENT '支付渠道ID',  //固定值 
  `user_id` varchar(50) DEFAULT NULL COMMENT '其他用户ID',  //百度ID    **有提供**
  `dk_userid` varchar(50) DEFAULT NULL COMMENT '多酷用户ID',  //null
  `bd_userid` varchar(50) DEFAULT NULL COMMENT '百度用户ID',//null
  `username` varchar(50) DEFAULT NULL COMMENT '用户名',    //非必须    **不能提供**
  `cp_order_serial` varchar(100) DEFAULT NULL COMMENT 'cp充值订单号',  //cp等单号 必传		    **有提供**
  `payment_order_serial` varchar(100) DEFAULT NULL COMMENT '消费订单号', //内部订单号
  `sp_order_serial` varchar(100) DEFAULT NULL COMMENT '合作方（渠道）订单号',  //anySDK订单号 必传	    **有提供**
  `bank_id` varchar(100) DEFAULT NULL COMMENT '渠道支付编码',  //非必传
  `create_time` datetime DEFAULT '0000-00-00 00:00:00' COMMENT '提交订单时间',  //创建订单时间
  `bank_date_time` datetime DEFAULT '0000-00-00 00:00:00' COMMENT '银行通知到账时间', //**anySDK订单通知时间**
  `order_type` int(11) DEFAULT NULL COMMENT '订单类型',  //默认值
  `pay_type` int(11) DEFAULT NULL COMMENT '支付方式',  //默认值
  `order_money` int(11) DEFAULT NULL COMMENT '订单金额（原价），跟CP对帐',  //金额
  `in_money` int(11) DEFAULT NULL COMMENT '需现金充值金额',  //金额  回调
  `bank_money` int(11) DEFAULT NULL COMMENT '银行实际收款金额',  //金额
  `baidu_out_money` int(11) DEFAULT NULL COMMENT '百度币消费金额',
  `voucher_out_money` int(11) DEFAULT NULL COMMENT '代金券消费金额',
  `kubi_out_moeny` int(11) DEFAULT NULL COMMENT '酷币消费金额',
  `voucher_id` varchar(50) DEFAULT NULL COMMENT '代金券id',
  `voucher_type` int(11) DEFAULT NULL COMMENT '代金券类型',
  `cp_id` varchar(20) DEFAULT NULL COMMENT 'CPID',
  `app_id` varchar(20) DEFAULT NULL COMMENT '应用ID',  //appId 必填      **有提供**
  `app_name` varchar(50) DEFAULT NULL COMMENT '应用名称',  //appName  **有提供**
  `merchandise_name` varchar(50) DEFAULT NULL COMMENT '商品名称',  //     **有提供**
  `order_status` tinyint(4) DEFAULT '0' COMMENT '订单状态', //创建 回调   **有提供**
  `ip_address` varchar(50) DEFAULT NULL,  
  `udid` varchar(50) DEFAULT NULL COMMENT 'iphone',
  `json_content` varchar(1000) DEFAULT NULL COMMENT '收银台下单上行信息',
  `cp_rate` int(11) DEFAULT NULL COMMENT '定额/非定额',
  `platform_id` int(11) DEFAULT NULL COMMENT '0默认网游，1单机',
  `client_confirmed` int(11) DEFAULT NULL COMMENT '客户端是否对该订单确认（发货），客户端发货',
  `exinfo` varchar(500) DEFAULT NULL,
  `actioninfo` varchar(2000) DEFAULT NULL COMMENT '活动透传字段',
  `callbackurl` varchar(500) DEFAULT NULL,
  `update_time` timestamp NULL DEFAULT '0000-00-00 00:00:00' COMMENT '时间戳',
  `version` int(11) DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;

![](media/14782267623725/14785189330401.jpg)


支付：
1·接收参数
2·参数校验
3·构建orderVo
4·回调sdk
5·推入队列

实现效果：
1·统一处理异常
2·统一返回状态码
3·统一返回协议
4·统一日志格式

![](media/14782267623725/14786012885304.jpg)
![](media/14782267623725/14786013050803.jpg)

![](media/14782267623725/14791890540392.jpg)

select * from pt_game_basic_info  limit 100


确认是否可传
银行到账时间 bank_time
银行到账金额 bank_money
订单状态要传 any_order_status
表中要添加唯一索引



![](media/14782267623725/14796338033524.jpg)


any_order_ctime=11111&any_order_id=11111&any_order_money=1.0&app_id=102&app_name=11111&baidu_user_id=11111&channel_number=11111&cp_order_id=11111&product_name=11111 明文转小写:7588df8ad835efc326252426054acc05 拼接MD5KEY:7588df8ad835efc326252426054acc0537c032c9a19547335998ff3bb7994a88 secureSign:c480745fa4be90929c25c19975d7427b


any_order_ctime=11111&any_order_id=11111&any_order_money=100&app_id=102&app_name=11111&baidu_user_id=11111&channel_number=11111&cp_order_id=11111&product_name=11111 明文转小写:96bb4705b66b920debb9a635ad4e9ce2 拼接MD5KEY:96bb4705b66b920debb9a635ad4e9ce237c032c9a19547335998ff3bb7994a88 secureSign:b40f62f47d65a77afad99303dba684b2


![](media/14782267623725/14792965256146.jpg)


降序排列:
Array
(
    [amount] => 1.00
    [channel_number] => 000084
    [channel_order_id] => 
    [channel_product_id] => 1
    [game_id] => 1000638
    [game_user_id] => test10001
    [order_id] => PB100016111619055736612
    [order_type] => 111
    [pay_status] => 1
    [pay_time] => 2016-11-16 19:05:57
    [plugin_id] => 52
    [private_data] => {"baidu_cooperator_order_serial":"18d6f81b-9800-4dd8-bf7d-b053b9d8be41","baidu_ext_info":"第X号服务器，Y游戏分区充值","baidu_user_id":"d6ae243fcdec43aabeade398f65736b6e855w","baidu_app_id":"3067515"}
    [product_count] => 1
    [product_id] => 1
    [product_name] => 100钻石
    [server_id] => 第X号服务器
    [source] => {"api_key":"2D7F93FBD29E400CAB6EE1061A41C684","close_time":"20161116190626","create_time":"20161116190557","deal_price":"1.00","out_order_no":"PB100016111619055736612","pay_channel":"100","submit_time":"20161116190557","user_id":"null","sign":"St7AOatRDFxGs05xVTxHsXychOOF+BZGZsd5dtM5Bbxa8lnsaeoFedR0Zwa3W4+yRyzz3BTfkG8jR3HF9i8eL+E5dbEp2FL127DB\/e90ws+f9QENadvbcMSPMg2eII0Ex0FzJlAe3pW+SUdFZFraHPQ2sM5rVtvRG2aKCRhjSrc="}
    [user_id] => 68C1CB11A373452DA7821DFD88B4E398
)

连接成的字符串:
1.0000008411000638test10001PB10001611161905573661211112016-11-16 19:05:5752{"baidu_cooperator_order_serial":"18d6f81b-9800-4dd8-bf7d-b053b9d8be41","baidu_ext_info":"第X号服务器，Y游戏分区充值","baidu_user_id":"d6ae243fcdec43aabeade398f65736b6e855w","baidu_app_id":"3067515"}11100钻石第X号服务器{"api_key":"2D7F93FBD29E400CAB6EE1061A41C684","close_time":"20161116190626","create_time":"20161116190557","deal_price":"1.00","out_order_no":"PB100016111619055736612","pay_channel":"100","submit_time":"20161116190557","user_id":"null","sign":"St7AOatRDFxGs05xVTxHsXychOOF+BZGZsd5dtM5Bbxa8lnsaeoFedR0Zwa3W4+yRyzz3BTfkG8jR3HF9i8eL+E5dbEp2FL127DB\/e90ws+f9QENadvbcMSPMg2eII0Ex0FzJlAe3pW+SUdFZFraHPQ2sM5rVtvRG2aKCRhjSrc="}68C1CB11A373452DA7821DFD88B4E398
第一次MD5值:
c0eb0609958ac1a2957e1d8be0e6210f
加入privatekey或增强密钥字符串:
c0eb0609958ac1a2957e1d8be0e6210fe69a44cbae600d7ab0f2ff18e4b044f4
重新计算的增强签名:
f9ac2274403105e30e671382f4b67153
AnySDK提供增强签名:
f9ac2274403105e30e671382f4b67153
ok(签名一致)


第一次MD5值:
c0eb0609958ac1a2957e1d8be0e6210f(这一步没问题，都能对上)
加入privatekey或增强密钥字符串:(这一步理论上是下面这个串 你们传的我不知道)
c0eb0609958ac1a2957e1d8be0e6210f7348838E62054517A8AB0989392D3D2E
重新计算的增强签名:
6c7e2b266a7e4f688d58ec5ae7986eb7(这是我这边的加密结果)
ec4e28d9b9ff5023a877689af03d5655(这是你们提供的)
![](media/14782267623725/14792995430802.jpg)

PB10001611161905573661211.001de9a21eb24adfbf192382fc10685eb932016-11-16 19:05:5768C1CB11A373452DA7821DFD88B4E398111test10001第X号服务器100钻石11{"baidu_cooperator_order_serial":"18d6f81b-9800-4dd8-bf7d-b053b9d8be41","baidu_debug_callback_url":"11111","baidu_ext_info":"第X号服务器，Y游戏分区充值","baidu_user_id":"d6ae243fcdec43aabeade398f65736b6e855w","baidu_app_id":"3067515"}0000841111111111100063852 明文MD5转小写:c7225e3c9d96e7d6c5e0407f484448f0 拼接MD5KEY:c7225e3c9d96e7d6c5e0407f484448f07348838E62054517A8AB0989392D3D2E secureSign:a47309b2bbcbf26971c692dc00821bc2

1.00000084111111de9a21eb24adfbf192382fc10685eb931000638test10001PB10001611161905573661211112016-11-16 19:05:5752{"baidu_cooperator_order_serial":"18d6f81b-9800-4dd8-bf7d-b053b9d8be41","baidu_debug_callback_url":"11111","baidu_ext_info":"第X号服务器，Y游戏分区充值","baidu_user_id":"d6ae243fcdec43aabeade398f65736b6e855w","baidu_app_id":"3067515"}11100钻石第X号服务器1111168C1CB11A373452DA7821DFD88B4E398 明文MD5转小写:22c1111d0bacceee2ba6cd8f212fc63e 拼接MD5KEY:22c1111d0bacceee2ba6cd8f212fc63e7348838E62054517A8AB0989392D3D2E secureSign:7ff8f92e104206515be19e42bbcd1680

问题：
创建订单时:需要校验订单是否已存在么
订单查询：返回的回调地址怎么回事儿。

![](media/14782267623725/14798054776050.jpg)


if( $("[name = chkItem]:checkbox").attr("checked")){

}









