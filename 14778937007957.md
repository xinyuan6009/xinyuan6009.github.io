# anySDK支付模块实施文档
##流程图
![](media/14778937007957/14778937736674.jpg)

##创建订单接口
方法名:createBaiduOrder(SDKOrder sdkOrder)(沟通anySDK创建订单是否依赖百度订单创建结果)
发放说明：根据企业级SDK传入的订单信息，在百度SDK数据服务器中创建百度订单数据。
接口要根据manager管理后台获取游戏-渠道封禁配置，如果游戏-渠道在封禁列表中，则返回相应的错误code和错误信息(根据项目进度：错误信息自定义）

| 参数名称 | 描述 | 来源 |
| --- | --- | --- |
| any_order_id | anySDK订单ID | anySDK |
| cp_order_id | 游戏订单ID | anySDK |
| channel | 渠道号() | anySDK |
| game_id | 游戏ID | anySDK |
| baidu_user_id | 百度用户ID | anySDK |
| sign | 数据签名 | anySDK |

注：创建订单接口不用接收订单金额么？
	 创建订单是否要进行IP白名单过滤
	
```java
	//创建百度订单
	createBaiduOrder(){
		validAccess(){
			//校验签名sign
			//appId黑名单
			//channel白名单
			//IP白名单？
		}
		
		saveBaiduOrder(){
			//将订单信息存入DB
			saveToDB();
			//将订单信息存入redis
			saveToRedis();
		}
	}
```
##完成支付订单确认
接口名称:checkOrderStatus()
参数列表：
![](media/14778937007957/14778952455873.jpg)
注：这里的user_id是anySDK那边的ID么？使用这个user_id生成的百度ID么？

接收支付通知步骤
1.接收AnySDK支付通知参数
2.检查AnySDK 支付通知服务IP白名单
3.验证签名及检查金额(根据anySDK订单号和游戏订单号获取百度订单信息)
注：订单校验都要校验那些字段呢？

```java
	//订单检查
	orderCheck(){
		validAccess(){
			//校验签名sign
			//appId黑名单
			//channel白名单
			//IP白名单？
		}
		
		//获取百度订单 从redis加载 不存在从db reload()
		baiduOrder = getBaiduOrder();
		
		boolean validFlag = validOrder(baiduOrder){
			//企业级SDK传入的订单信息与百度订单信息做校验
			//具体要校验那些信息？？？？
		}
		//如果上面校验成功，调用
		if(validFlag){
			boolean confirmed = orderConfirm();
			if(confirmed){
				//更新订单状态  是在这一步更新？
				updateBaiduOrderStatus();
				//将确认后的订单    信息推送到MQ队列，以供后续处理
				orderPushToMq();
			}
		}
	
	}
```

##订单校验通过 去 AnySDK企业版服务器 查询订单状态
接口名称：orderConfirm()

| 参数 | 类型 | 来源 |
| --- | --- | --- |
| order_id | 订单号 | 通知参数 |
| game_id | 游戏ID | 通知参数 |
| channel | 渠道 | 通知参数 |
| sign | 签名 | 通知参数 |

功能描述：将百度SDK校验结果以及订单信息发送给anySDK,查询订单状态

注：远程调用等待时间是否有限制？
	 远程调用失败是否重试？要重试的话，重试几次？

##异步回调支付系统 orderPush()
接口名称：orderPush();
功能描述：将订单信息推送到MQ队列



陶梁  李星照  陈明东




